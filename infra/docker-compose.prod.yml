# ğŸš€ HireHub Production Docker Compose (AWS EC2 ë°°í¬ìš©)
# version í‚¤ëŠ” Docker Compose v2 ì´ìƒì—ì„œëŠ” ë¶ˆí•„ìš”í•˜ë¯€ë¡œ ì œê±°í•¨.

services:
  backend:
    image: ${BACKEND_IMAGE}                       # ğŸ”¹ ê¹ƒì‹œí¬ë¦¿ì—ì„œ ìë™ ì£¼ì… (ì˜ˆ: noeyos/hirehub-backend:latest)
    container_name: backend
    env_file:
      - ../backend/backend/.env.prod                      # ğŸ”¹ Actionsì—ì„œ EC2ë¡œ ìë™ ì—…ë¡œë“œëœ í™˜ê²½ë³€ìˆ˜ íŒŒì¼
    environment:
      SPRING_PROFILES_ACTIVE: aws                 # ğŸ”¹ Spring Boot í”„ë¡œíŒŒì¼
      RDS_ENDPOINT: ${RDS_ENDPOINT}               # ğŸ”¹ RDS í˜¸ìŠ¤íŠ¸ëª… (Secrets â†’ ì£¼ì…)
      JWT_SECRET: ${JWT_SECRET}                   # ğŸ”¹ JWT í‚¤ (Secrets â†’ ì£¼ì…)
      JAVA_OPTS: "--add-opens java.base/java.lang=ALL-UNNAMED"
    ports:
      - "8080:8080"
    restart: unless-stopped
    networks:
      - hirehub-net

  frontend:
    image: ${FRONTEND_IMAGE}                      # ğŸ”¹ ê¹ƒì‹œí¬ë¦¿ì—ì„œ ìë™ ì£¼ì… (ì˜ˆ: noeyos/hirehub-frontend:latest)
    container_name: frontend
    depends_on:
      - backend
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt:ro      # ğŸ”¹ SSL ì¸ì¦ì„œ ê³µìœ  ë³¼ë¥¨
      - /etc/ssl/certs:/etc/ssl/certs:ro
    restart: unless-stopped
    networks:
      - hirehub-net

# ğŸ”¹ Docker Compose v2 ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ (frontend â†” backend ì—°ê²°ìš©)
networks:
  hirehub-net:
    driver: bridge
