# ===== Build assets =====
FROM node:20-alpine AS build
WORKDIR /app

# ğŸ”¹ íŒ¨í‚¤ì§€ ë³µì‚¬ + ì˜ì¡´ì„± ì„¤ì¹˜
COPY package.json package-lock.json* yarn.lock* pnpm-lock.yaml* ./
RUN npm ci || yarn install 

# ğŸ”¹ ì†ŒìŠ¤ ë³µì‚¬
COPY . .

# âœ… í™˜ê²½ë³€ìˆ˜ ì£¼ì… (.env.prodëŠ” ê°™ì€ í´ë”)
COPY .env.prod .env.prod
RUN export $(cat .env.prod | xargs) && npm run build || yarn build

# ===== Nginx serve =====
FROM nginx:1.27-alpine

# ğŸ”¹ Nginx ì„¤ì • ë³µì‚¬
COPY ./nginx.conf /etc/nginx/conf.d/default.conf

# ğŸ”¹ ë¹Œë“œ ê²°ê³¼ë¬¼ ë³µì‚¬
COPY --from=build /app/dist /usr/share/nginx/html

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
